---
layout: post
title:  "数据库-Mycat2整体结构"
tags: 数据库
---

### mycat2的目标是成为一个分布式数据系统,数据库系统框图如下

![数据库系统结构](../../../images/postimg/数据库系统结构.jpg)

![数据库底层设计](../../../images/postimg/数据库底层设计.jpg)


### mycat整体分为如下3部分

- **前端链接器** io.mycat.proxy.handler.MycatHandler

    1.处理网络事件 (接入链接, 读, 写, 关闭)

- **分析器** io.mycat.client.MycatClient#analysis(String sql)

    确认以下结果
    
    1.哪个目标数据源 
    
    2.哪个目标库 
    
    3.哪个目标表 
    
    4.是否开事物 
    
    5.是否分片,分片类型 
    
    6.用哪个执行器

- **执行器**  

   1.根据事物级别,建立后端数据库的链接 (两个实现 1.proxy 2.jdbc(xa))
   
   2.增加mycat的sql语法 
   
   3.选择数据库的客户端. proxy 或 jdbc
   
   代码: 接口 io.mycat.Command
   
        io.mycat.upondb.MycatDBClientApi (用于实现mycat自己的语法)
        
        io.mycat.proxy.handler.BackendNIOHandler
        
        io.mycat.MySQLTaskUtil#proxyBackend
        
        TransactionSessionUtil

### mycat链接器


        /**
         * mycat客户端
         * @author Junwen Chen
         **/
        public interface MycatClient extends MycatDataContext {
            /**
             * 分析器, 用于确认以下结果
             * 1.哪个目标数据源 2.哪个目标库 3.哪个目标表 4.是否开事物 5.是否分片,分片类型 6.用哪个执行器
             *
             * mycat整体分为如下3部分
             *{@link  MySQLProxySession}
             * 1. 前端链接器 {@link io.mycat.proxy.handler.MycatHandler,}
             * 2. 分析器 {@link MycatClient#analysis(String)}
             * 3. 执行器 {@link io.mycat.Command}
             * 4. 后端链接器 {@link io.mycat.upondb.MycatDBClientApi}
             *
             * @param sql 需要分析的sql
             * @return 这些结果的数据集 {1.目标数据源 2.目标库 3.目标表 4.是否开事物 5.是否分片,分片类型 6.执行器 7.上下文的变量}
             * 在以下情况被调用
             * 链接器的 指令类型为查询时 {@link io.mycat.beans.mysql.MySQLCommandType#COM_QUERY}
             * 执行器的 语句执行时 {@link io.mycat.ContextRunner#EXPLAIN}
             */
            public Context analysis(String sql) ;
            public void useSchema(String schemaName);
            public TransactionType getTransactionType();
            public void useTransactionType(TransactionType transactionType);
            public String getDefaultSchema();
        
            public <T> T getMycatDb();
        }
        
        