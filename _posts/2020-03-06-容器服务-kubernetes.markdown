---
layout: post
title:  "容器服务-kubernetes"
tags: 容器服务
---

官方中文文档
[https://www.kubernetes.org.cn/k8s](https://www.kubernetes.org.cn/k8s "https://www.kubernetes.org.cn/k8s")


内网环境：web0-web9

内网部署： Jenkins

线上部署： Jenkins

日常维护： 阿里云控制台

服务器登陆：阿里云控制台


### 概念

**应用关键词**： RDS，ECS, namespace, Nacos

**容器服务关键词**： namespace, VPC, K8S, POD, NAT网关，SLB，安全组，kubectl ，Worker，宿主机, 交换机

 --- 
 
### 阿里云控制台：

1.部署

2.日志

3.ECS登陆

4.服务观测

5.无感上线

6.包版本管理

7.maven私服

8.注册中心

9.配置中心

 --- 
 
**如何解决两个相同应用不同数据库的问题** (北京与鸿洲)

  方式1 = 准备两套隔离的环境, 两套线上部署的配置文件, 分别部署到不同的k8s环境中.
  
  方式2 = 根据域名控制服务调用的路由规则. 

 --- 
 
**阿里云部署方式**  (我们选择蓝绿发布, 在容器服务-k8s-路由与负载均衡菜单中)

蓝绿发布 = 利用冗余的服务进行流量切换

灰度发布 = 在蓝绿发布的基础上, 增加了根据request内容控制流量切换. 


 --- 
 
**阶段性的过程**

- 2月25日结束 (让新项目运行起来)

- free,ander-3月6日结束 (检查并同步项目最新代码, 并将问题总结至 服务端研发(推广) )

- hao-3月6日结束 (实现迭代与切换办法, 同时整两套线上环境)

- hao起草文档, free,ander,jerry检查文档并提出问题, 

- hao参照提出的问题根据实际情况更新运环境, 

- 后续文档如下需随着业务发展长期更新.

| | 需要的文档|
|1| 后端研发规范与违规措施|
|2| 阿里云线上研发 服务化部署-测试-调试-监控的文档.|
|3| 内网自建环境的 服务化部署-测试-调试-监控的文档.|


- 3月9日结束 (尝试一次迭代至新生产环境)

- 结束 (如果失败则继续步骤3)

 --- 

**后续升级** (长期)

服务化监控 （服务可观测）

收敛服务 （api包）

拆分数据库 （mapper包）

去除剩余耦合代码 (util包，common包，framework包)

拆分小程序项目

优化调用链

定义模块化开发逻辑

 --- 

**目前的问题** (请free与ander先帮忙解决问题1和问题2.   hao在3月6日内把迭代流程与环境搞定)

代码不是最新的, 需要各自检查代码有无遗漏或业务逻辑错误. (free, ander, hao)

大量的接口超时, 需要优化.  比如: /api/talent/search/selectTalentPage 10秒内无法响应 (free,ander,hao)

整理迭代流程(不然无法切换) (hao)

常见问题及解决办法 (大家可以先汇总到这里)

服务超时问题 (1.优化接口 2.增加超时时间(生产者加,或消费者加,建议生产者加) 3.增加dubbo线程数量(在调用次数过多,并且平均响应超过500ms下会出现) 4.减少调用次数 5.减少传输数据大小,响应控制在500kb内)


 --- 
 
服务端服务化改造, 从发现起日, 至以后要注意的地方, 以后会整理起来, 列成规范. 