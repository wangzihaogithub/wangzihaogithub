---
layout: post
title:  "业务沉淀-技术难度(中)-业务复杂(高)-财务快照"
tags: 业务沉淀
---

**先临时记下， 后期补上细节**

- 无感上线 (蓝绿发布， 流量切换，nginx + lua脚本 )， 

- 牵头服务化迁移(K8S, 阿里云，修复springcloud-alibaba开源框架bug，成为committer)，
 
- 推荐报告 (定制开源框架 http://deepoove.com/poi-tl， https://github.com/Sayi/poi-tl)， 

- 财务快照 (数据清洗 + 多维度临时表计算 + join + 临时表排序)，

- 实现develop流程建设（Jenkins + git + yapi + wiki + 禅道 + 内网物理机房 + 阿里云集群）

- 依据大佬的文档, 落地ERP2.0改造 (库存申请单，领料单，出入库单（各类型创建与打印机调试），发运单（计算损耗与回收）， MRP，物料，BOM（多版本控制）, 采购计划，生产计划+订单，ERP销售订单)

- 牵头整个公司的供货计划 (需求 = 预测 + 订单。 各个部门的需求订单,预订单)

- 文件夹分享，（业务复杂， 数据结构 head，parentCode, like%）

- 牵头新老系统平滑迁移 （解耦系统, 搞个洗数据的框架，定制开源框架 Canal ），

- 人才搜索 （elasticsearch搭建3节点，Canal源码分析，版本切换，数据清洗 ），

- 接口文档管理 (提供大前端二次开发mongodb，后端拿数据给日志系统复用)， 

- 线上数据库(RDS)快照，可以随便动线上数据开发测试(秒级恢复至任意日期的快照)。


公司的财务, 需要手工做业绩报表(月度,季度,年度) 


### 需求描述


### 技术难点

    入: 用户条件
    
    多空间维度(快照日期) 并行计算 {
        基础维度(回款, 开票) 并行计算{
            1.数据库filter (过滤) 不同维度用的过滤字段不同
            2.java代码 (改维度)
            
            1.数据库groupby-tree(聚合计算) 
            2.java代码(改排序)
            
            1.数据库full join(全连接排序)
            2.java代码(调用其他服务,补字段)
        }
    }
    
    1.数据库reduce(维度合并)
    2.java代码(java计算金额分配比率)
    
    1.数据库pageable(分页排序)
    2.java代码(页面底部求和)
    
    
    注: 
    父部门要计算所有子部门的先求和, 再聚合计算. 再日期同比计算.
    sql上无法直接连表用父部门id去groupby, 所以拆开了,
    业务上不能先小聚合在大聚合求和, 不然算的不对

    
### 业务复杂点


